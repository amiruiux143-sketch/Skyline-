<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Skyline store</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --sky: #00d2ff;
            --sky-dark: #0088aa;
            --bg: #000000;
            --card: #0c0c0c;
            --border: #1a1a1a;
            --text-main: #ffffff;
            --text-dim: #666666;
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Inter', sans-serif;
            outline: none;
        }

        body {
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        /* --- ЭКРАН ЗАГРУЗКИ (BOOT) --- */
        #boot-loader {
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 20000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease;
        }
        .loading-bar {
            width: 150px;
            height: 2px;
            background: #111;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }
        .loading-progress {
            position: absolute;
            height: 100%;
            width: 0%;
            background: var(--sky);
            box-shadow: 0 0 10px var(--sky);
            animation: load 2s forwards;
        }

        /* --- ЭКРАН АВТОРИЗАЦИИ --- */
        #auth-screen {
            position: fixed;
            inset: 0;
            background: var(--bg);
            z-index: 10000;
            display: none;
            padding: 40px 30px;
            flex-direction: column;
            justify-content: center;
        }
        .auth-logo {
            text-align: center;
            margin-bottom: 50px;
        }
        .auth-logo h1 {
            font-size: 42px;
            font-weight: 900;
            letter-spacing: -2px;
            margin: 0;
        }
        .auth-logo span { color: var(--sky); }

        .input-group { margin-bottom: 20px; }
        .input-label {
            display: block;
            font-size: 10px;
            font-weight: 800;
            color: var(--text-dim);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .sky-input {
            width: 100%;
            background: var(--card);
            border: 1px solid var(--border);
            padding: 18px;
            border-radius: 16px;
            color: #fff;
            font-size: 16px;
            transition: border 0.3s;
        }
        .sky-input:focus { border-color: var(--sky); }

        .btn-prime {
            width: 100%;
            padding: 20px;
            background: var(--sky);
            color: #000;
            border: none;
            border-radius: 18px;
            font-weight: 900;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            box-shadow: 0 10px 20px rgba(0,210,255,0.2);
        }

        /* --- ГЛАВНЫЙ ИНТЕРФЕЙС --- */
        #shell {
            display: none;
            height: 100vh;
            flex-direction: column;
        }

        header {
            padding: 20px;
            padding-top: calc(20px + env(safe-area-inset-top));
            border-bottom: 1px solid var(--border);
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
        }
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .user-pill {
            background: #111;
            padding: 6px 12px;
            border-radius: 100px;
            border: 1px solid var(--border);
            font-size: 10px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .search-container {
            position: relative;
        }
        .search-container i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-dim);
        }
        .search-input {
            width: 100%;
            background: #0f0f0f;
            border: 1px solid var(--border);
            padding: 12px 12px 12px 45px;
            border-radius: 12px;
            color: #fff;
            font-size: 14px;
        }

        /* --- КОНТЕНТ --- */
        .viewport {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 150px;
        }
        .page { display: none; }
        .page.active { display: block; animation: slideUp 0.4s cubic-bezier(0,0,0.2,1); }

        .section-title {
            font-size: 22px;
            font-weight: 800;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* КАРТОЧКА ПРИЛОЖЕНИЯ */
        .app-item {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 16px;
            margin-bottom: 16px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .app-main-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .app-icon {
            width: 64px;
            height: 64px;
            background: #1a1a1a;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: var(--sky);
            box-shadow: inset 0 0 15px rgba(0,0,0,0.5);
        }
        .app-texts { flex: 1; }
        .app-name { font-weight: 800; font-size: 17px; margin-bottom: 4px; }
        .app-meta { font-size: 11px; color: var(--text-dim); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }

        .app-description {
            font-size: 13px;
            color: #999;
            line-height: 1.5;
            background: #080808;
            padding: 12px;
            border-radius: 14px;
        }

        .download-zone {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .btn-install {
            flex: 1;
            background: var(--sky);
            color: #000;
            padding: 14px;
            border-radius: 14px;
            font-weight: 900;
            font-size: 13px;
            text-align: center;
            text-decoration: none;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-install:active { transform: scale(0.96); }

        /* --- ПАНЕЛЬ АДМИНА --- */
        .admin-form { display: flex; flex-direction: column; gap: 15px; }
        .file-upload-wrapper {
            border: 2px dashed var(--border);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            color: var(--text-dim);
        }
        /* --- НАВИГАЦИЯ --- */
        nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: rgba(5,5,5,0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
            display: flex;
            padding: 15px 0 calc(15px + var(--safe-area-bottom));
            z-index: 1000;
        }
        .nav-tab {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: #444;
            font-size: 10px;
            font-weight: 800;
            transition: 0.3s;
        }
        .nav-tab i { font-size: 20px; }
        .nav-tab.active { color: var(--sky); }

        /* --- УВЕДОМЛЕНИЯ --- */
        #toast {
            position: fixed;
            top: -100px;
            left: 20px;
            right: 20px;
            background: var(--sky);
            color: #000;
            padding: 15px;
            border-radius: 12px;
            font-weight: 800;
            text-align: center;
            z-index: 30000;
            transition: top 0.5s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }

        @keyframes load { to { width: 100%; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="toast">SYSTEM NOTIFICATION</div>

    <div id="boot-loader">
        <h1 style="font-weight:900; letter-spacing:-2px;">SKY<span style="color:var(--sky)">LINE</span> OS</h1>
        <div class="loading-bar"><div class="loading-progress"></div></div>
        <p style="font-size:10px; color:#333; margin-top:10px; font-weight:800;">KERNEL V17.0.4 LOADING...</p>
    </div>

    <div id="auth-screen">
        <div class="auth-logo">
            <h1>SKY<span>LINE</span></h1>
            <p style="color:var(--text-dim); font-size:12px; margin-top:10px; font-weight:600;">ENCRYPTED CLOUD ACCESS</p>
        </div>
        
        <div class="input-group">
            <label class="input-label">Identity / Email</label>
            <input type="email" id="login-email" class="sky-input" placeholder="name@example.com" autocomplete="off">
        </div>
        
        <div class="input-group">
            <label class="input-label">Security Key</label>
            <input type="password" id="login-pass" class="sky-input" placeholder="••••••••" autocomplete="off">
        </div>

        <button class="btn-prime" onclick="kernel.boot()">INITIALIZE SESSION</button>
        
        <p style="text-align:center; font-size:11px; color:#222; margin-top:40px;">PRIVATE SYSTEM — AUTHORIZED ONLY</p>
    </div>

    <div id="shell">
        <header>
            <div class="header-top">
                <div class="user-pill" id="user-badge">
                    <i class="fa fa-circle" style="color:#333; font-size:8px;"></i> GUEST
                </div>
                <div style="font-weight:900; font-size:14px; letter-spacing:1px; color:var(--sky)">SKYLINE STORE</div>
                <i class="fa fa-cog" style="color:#333"></i>
            </div>
            <div class="search-container">
                <i class="fa fa-search"></i>
                <input type="text" id="global-search" class="search-input" placeholder="Search apps, tools..." onkeyup="kernel.filter()">
            </div>
        </header>

        <div class="viewport">
            <div id="page-market" class="page active">
                <div class="section-title"><i class="fa fa-rocket" style="color:var(--sky)"></i> Essentials</div>
                <div id="app-grid">
                    <div style="text-align:center; padding:50px; color:#222;"><i class="fa fa-sync fa-spin"></i></div>
                </div>
            </div>

            <div id="page-admin" class="page">
                <div class="section-title"><i class="fa fa-shield-alt" style="color:var(--sky)"></i> Developer Console</div>
                <div class="admin-form">
                    <div class="input-group">
                        <label class="input-label">App Title</label>
                        <input type="text" id="up-name" class="sky-input" placeholder="e.g. Skyline Mod">
                    </div>
                    <div class="input-group">
                        <label class="input-label">Detailed Description</label>
                        <textarea id="up-desc" class="sky-input" rows="4" placeholder="Version notes, features..."></textarea>
                    </div>
                    <div class="file-upload-wrapper" onclick="document.getElementById('up-file').click()">
                        <i class="fa fa-cloud-upload-alt" style="font-size:30px; margin-bottom:10px;"></i>
                        <p id="file-status">Select APK source</p>
                        <input type="file" id="up-file" style="display:none" onchange="kernel.handleFile(this)">
                    </div>
                    <button class="btn-prime" id="btn-deploy" onclick="kernel.deploy()">DEPLOY TO CLOUD</button>
                </div>
            </div>
        </div>

        <nav>
            <div class="nav-tab active" id="tab-m" onclick="kernel.switch('market')">
                <i class="fa fa-compass"></i>
                <span>EXPLORE</span>
            </div>
            <div class="nav-tab" id="tab-a" style="display:none" onclick="kernel.switch('admin')">
                <i class="fa fa-terminal"></i>
                <span>ADMIN</span>
            </div>
        </nav>
    </div>

    <iframe id="sys-dl" style="display:none"></iframe>

    <script>
        /* SKYLINE KERNEL v17.5 
           Fixed: Persistent Login & Download Engine
        */

        const CONFIG = {
            BOT_TOKEN: "8358797080:AAGamsFDYRfMn7FDWf4GKZDzJNHZj6eeDQg",
            CHAT_ID: "7076467876",
            CHANNEL: "skylineApp",
            ADMIN_EMAIL: "amirmamedgasanov5@gmail.com",
            ADMIN_PASS: "18021953"
        };

        let appDatabase = [];

        const kernel = {
            // 1. ЗАПУСК СИСТЕМЫ И ПРОВЕРКА ПАМЯТИ
            init() {
                const savedE = localStorage.getItem('sky_email');
                const savedP = localStorage.getItem('sky_pass');

                setTimeout(() => {
                    document.getElementById('boot-loader').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('boot-loader').style.display = 'none';
                        
                        if(savedE && savedP) {
                            this.autoBoot(savedE, savedP);
                        } else {
                            document.getElementById('auth-screen').style.display = 'flex';
                        }
                    }, 500);
                }, 2200);
            },

            autoBoot(e, p) {
                document.getElementById('login-email').value = e;
                document.getElementById('login-pass').value = p;
                this.boot(true);
            },

            // 2. ВХОД И СОХРАНЕНИЕ
            boot(isAuto = false) {
                const e = document.getElementById('login-email').value.trim();
                const p = document.getElementById('login-pass').value.trim();
                
                if(!e || !p) {
                    this.notify("ENTER CREDENTIALS");
                    return;
                }

                localStorage.setItem('sky_email', e);
                localStorage.setItem('sky_pass', p);

                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('shell').style.display = 'flex';
                
                if(e === CONFIG.ADMIN_EMAIL && p === CONFIG.ADMIN_PASS) {
                    document.getElementById('tab-a').style.display = 'flex';
                    document.getElementById('user-badge').innerHTML = '<i class="fa fa-crown" style="color:var(--sky)"></i> KING';
                    if(!isAuto) this.notify("WELCOME BACK, MY KING");
                } else {
                    document.getElementById('user-badge').innerHTML = '<i class="fa fa-user" style="color:#555"></i> GUEST';
                    if(!isAuto) this.notify("GUEST SESSION STARTED");
                }
                this.sync();
            },

            switch(page) {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                if(page === 'market') {
                    document.getElementById('page-market').classList.add('active');
                    document.getElementById('tab-m').classList.add('active');
                } else {
                    document.getElementById('page-admin').classList.add('active');
                    document.getElementById('tab-a').classList.add('active');
                }
            },

            notify(msg) {
                const t = document.getElementById('toast');
                t.innerText = msg;
                t.style.top = '20px';
                setTimeout(() => { t.style.top = '-100px'; }, 3000);
            },

            // 3. РАБОТА С ФАЙЛАМИ И ОБЛАКОМ
            async sync() {
                try {
                    const ts = Date.now();
                    const url = `https://api.rss2json.com/v1/api.json?rss_url=https://tg.i-c-a.su/rss/${CONFIG.CHANNEL}&t=${ts}`;
                    const res = await fetch(url);
                    const data = await res.json();
                    if(data.items) {
                        appDatabase = data.items;
                        this.render(appDatabase);
                    }
                } catch(err) {
                    this.notify("SYNC FAILED");
                }
            },

            render(items) {
                const grid = document.getElementById('app-grid');
                if(!items.length) {
                    grid.innerHTML = '<p style="text-align:center; color:#222; margin-top:50px;">CLOUD EMPTY</p>';
                    return;
                }

                grid.innerHTML = items.map((app, index) => {
                    const links = app.description.match(/https?:\/\/[^\s"<>]+/g) || [];
                    let dlUrl = links[0] || app.link;
                    dlUrl = dlUrl.replace('t.me/', 'tg.i-c-a.su/media/');
                    const meta = app.description.split('\n\n');
                    return `
                        <div class="app-item">
                            <div class="app-main-info">
                                <div class="app-icon"><i class="fa fa-cube"></i></div>
                                <div class="app-texts">
                                    <div class="app-name">${app.title}</div>
                                    <div class="app-meta">Stable • APK • Global</div>
                                </div>
                            </div>
                            <div class="app-description">${meta[1] || "Verified by Skyline OS Kernel."}</div>
                            <div class="download-zone">
                                <button class="btn-install" onclick="kernel.forceDL('${dlUrl}', '${app.title}')">
                                    <i class="fa fa-download"></i> INSTALL APPLICATION
                                </button>
                            </div>
                        </div>`;
                }).join('');
            },

            // УЛЬТИМАТИВНЫЙ МЕТОД СКАЧИВАНИЯ
            async forceDL(url, name) {
                this.notify("OPENING SYSTEM INSTALLER...");
                const link = document.createElement('a');
                link.href = url;
                link.download = name + '.apk';
                link.target = '_blank';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            },

            filter() {
                const q = document.getElementById('global-search').value.toLowerCase();
                this.render(appDatabase.filter(a => a.title.toLowerCase().includes(q)));
            },

            handleFile(input) {
                if(input.files[0]) document.getElementById('file-status').innerText = input.files[0].name;
            },

            async deploy() {
                const file = document.getElementById('up-file').files[0];
                const name = document.getElementById('up-name').value;
                const desc = document.getElementById('up-desc').value;
                if(!file || !name) return this.notify("MISSING DATA");

                const btn = document.getElementById('btn-deploy');
                btn.innerText = "UPLOADING...";
                btn.disabled = true;

                const fd = new FormData();
                fd.append('chat_id', CONFIG.CHAT_ID);
                fd.append('document', file);
                fd.append('caption', name + "\n\n" + desc);

                try {
                    await fetch(`https://api.telegram.org/bot${CONFIG.BOT_TOKEN}/sendDocument`, {method:'POST', body:fd});
                    this.notify("DEPLOYED!");
                    setTimeout(() => location.reload(), 1000);
                } catch(e) {
                    this.notify("ERROR");
                    btn.disabled = false;
                    btn.innerText = "DEPLOY TO CLOUD";
                }
            }
        };

        window.onload = () => kernel.init();
            </script>
</body>
</html>