<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skyline Infinity | No-Firebase Edition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg: #000; --accent: #00d2ff; --card: rgba(255,255,255,0.05); }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding-bottom: 80px; }
        
        /* Экран «Входа» (Простая имитация) */
        #authScreen { position: fixed; inset: 0; background: #000; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #mainContent { display: none; }

        .header { padding: 20px; background: rgba(0,0,0,0.8); backdrop-filter: blur(15px); border-bottom: 1px solid #111; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; }
        .container { padding: 20px; }
        .page { display: none; }
        .active { display: block; }

        .app-item { background: var(--card); border: 1px solid #111; border-radius: 20px; padding: 15px; display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .app-logo { width: 50px; height: 50px; border-radius: 12px; background: #111; display: flex; align-items: center; justify-content: center; color: var(--accent); }
        
        .btn-big { width:100%; padding:15px; background:var(--accent); border:none; border-radius:12px; font-weight:bold; cursor:pointer; color: #000; margin-top: 10px; }
        input { width: 100%; padding: 12px; background: #111; border: 1px solid #222; color: white; border-radius: 10px; margin-bottom: 15px; box-sizing: border-box; }

        .nav { position: fixed; bottom: 0; width: 100%; background: rgba(0,0,0,0.9); display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #111; }
        .nav i { font-size: 22px; color: #444; cursor: pointer; }
        .nav i.active-nav { color: var(--accent); }
    </style>
</head>
<body>

<div id="authScreen">
    <h1 style="letter-spacing: 3px;">SKYLINE <span style="color:var(--accent)">INFINITY</span></h1>
    <div style="width: 80%;">
        <input type="text" id="username" placeholder="Ваше имя (Логин)">
        <button class="btn-big" onclick="localLogin()">ВОЙТИ В СИСТЕМУ</button>
    </div>
</div>

<div id="mainContent">
    <div class="header">
        <div style="font-weight: 800;">SKYLINE <span style="color:var(--accent)">INF</span></div>
        <div id="userNameDisplay" style="font-size: 12px; color: var(--accent);"></div>
    </div>

    <div class="container">
        <div id="homePage" class="page active">
            <div id="appList">Сканирование файлов...</div>
        </div>

        <div id="uploadPage" class="page">
            <h2 style="color:var(--accent)">Загрузить в Skyline</h2>
            <input type="text" id="appName" placeholder="Название">
            <input type="file" id="appFile">
            <input type="password" id="adminKey" placeholder="Секретный токен (ghp_...)">
            <button class="btn-big" onclick="handleUpload()" id="upBtn">ОПУБЛИКОВАТЬ</button>
        </div>
    </div>

    <div class="nav">
        <i class="fa fa-home active-nav" onclick="nav('homePage', this)"></i>
        <i class="fa fa-plus-circle" onclick="nav('uploadPage', this)"></i>
        <i class="fa fa-sign-out" onclick="location.reload()"></i>
    </div>
</div>

<script>
    const USER = "amiruiux143-sketch";
    const REPO = "Skyline-";

    // 1. Простая регистрация без сторонних сервисов
    function localLogin() {
        const name = document.getElementById('username').value;
        if (name.length < 2) return alert("Введите имя!");
        
        localStorage.setItem('skyline_user', name);
        showMain(name);
    }

    function showMain(name) {
        document.getElementById('authScreen').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
        document.getElementById('userNameDisplay').innerText = "Привет, " + name;
        loadApps();
    }

    // Проверка при загрузке
    const savedUser = localStorage.getItem('skyline_user');
    if (savedUser) showMain(savedUser);

    // 2. Навигация
    function nav(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav i').forEach(n => n.classList.remove('active-nav'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active-nav');
    }

    // 3. Загрузка через GitHub API (без хранения токена в коде)
    async function handleUpload() {
        const token = document.getElementById('adminKey').value;
        const name = document.getElementById('appName').value;
        const file = document.getElementById('appFile').files[0];
        
        if (!token.startsWith('ghp_')) return alert("Вставьте правильный токен!");
        if (!file) return alert("Выберите файл!");

        const btn = document.getElementById('upBtn');
        btn.innerText = "ЗАГРУЗКА...";
        
        const reader = new FileReader();
        reader.onload = async () => {
            const content = reader.result.split(',')[1];
            const fileName = Date.now() + "_" + file.name;
            
            try {
                const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/files/${fileName}`, {
                    method: "PUT",
                    headers: { "Authorization": `token ${token}` },
                    body: JSON.stringify({ message: `Add ${name}`, content: content })
                });

                if (res.ok) {
                    alert("Успешно загружено!");
                    nav('homePage', document.querySelector('.fa-home'));
                    loadApps();
                } else { alert("Ошибка! Проверь токен."); }
            } catch (e) { alert("Ошибка сети"); }
            btn.innerText = "ОПУБЛИКОВАТЬ";
        };
        reader.readAsDataURL(file);
    }

    // 4. Список файлов
    async function loadApps() {
        try {
            const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/files`);
            const data = await res.json();
            document.getElementById('appList').innerHTML = data.map(f => `
                <div class="app-item">
                    <div class="app-logo"><i class="fa fa-cube"></i></div>
                    <div style="flex:1"><b>${f.name.split('_')[1] || f.name}</b></div>
                    <a href="${f.download_url}" class="btn-get" style="background:var(--accent);color:#000;padding:5px 15px;border-radius:10px;text-decoration:none;font-weight:bold;font-size:12px;">GET</a>
                </div>
            `).reverse().join('');
        } catch(e) { document.getElementById('appList').innerHTML = "Пока пусто."; }
    }
</script>
</body>
</html>
